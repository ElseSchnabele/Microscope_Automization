<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Camera-Filter Syncronization: Microscope_Automization</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Camera-Filter Syncronization
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Microscope_Automization</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a>A Microscope Automatization Project of Jan Niklas Topf and Frederick Krafft </p>
<h1><a class="anchor" id="autotoc_md1"></a>
Class Diagram</h1>
<p>The project structure is visualized in the following class diagram: </p><div class="fragment"><div class="line">classDiagram</div>
<div class="line"> </div>
<div class="line">CFsyncApp o-- CameraFilterSyncronizer: Create Images</div>
<div class="line">CameraFilterSyncronizer --&gt; ImageNormalizer: Normalize Images</div>
<div class="line">CameraFilterSyncronizer --&gt; PowerCalibrator: Pull power values</div>
<div class="line">CFsyncApp o-- TifStackViewer_matplot: Show images</div>
<div class="line">TifStackViewer_matplot o-- ShowSpectra: clickevent</div>
<div class="line">TifStackViewer_matplot o-- ShowSpectra_Area: markevent</div>
<div class="line">    class CFsyncApp {</div>
<div class="line">        +root: TkinterWidget</div>
<div class="line">        -error_message_min_wavelength: Label</div>
<div class="line">        -error_message_max_wavelength: Label</div>
<div class="line">        -error_message_exposure_time: Label</div>
<div class="line">        -min_wavelength_spinbox: Spinbox</div>
<div class="line">        -max_wavelength_spinbox: Spinbox</div>
<div class="line">        -exposure_time_entry: Entry</div>
<div class="line">        -filename_entry: Entry</div>
<div class="line">        -open_folder_button: Button</div>
<div class="line">        -selected_folder: StringVar</div>
<div class="line">        -selected_file: StringVar</div>
<div class="line">        -calib_file_dropdown: OptionMenu</div>
<div class="line">        -output_text: Text</div>
<div class="line"> </div>
<div class="line">        +__init__(root: TkinterWidget)</div>
<div class="line">        +run_script()</div>
<div class="line">        +display_error_message(label: Label, message: str)</div>
<div class="line">        +validate_entry(entry: Entry, error_message_label: Label, validation_function: function, error_message: str): bool</div>
<div class="line">        +validate_integer(P: str): bool</div>
<div class="line">        +validate_float(P: str): bool</div>
<div class="line">        +min_smaller_max(min_and_max: Tuple, error_message_label: Label, error_message: str): bool</div>
<div class="line">        +open_window_tif_view()</div>
<div class="line">        +open_folder()</div>
<div class="line">        +update_calib_file_dropdown(folder_path: str)</div>
<div class="line">    }</div>
<div class="line">    class CameraFilterSyncronizer {</div>
<div class="line">        -_wavelengths: list</div>
<div class="line">        -_hdl: KuriosHandle</div>
<div class="line">        -_exposure: int</div>
<div class="line">        -_image_width: int</div>
<div class="line">        -_image_height: int</div>
<div class="line">        -_is_color_camera: bool</div>
<div class="line">        -_mono_to_color_sdk: MonoToColorProcessorSDK</div>
<div class="line">        -_mono_to_color_processor: MonoToColorProcessor</div>
<div class="line"> </div>
<div class="line">        +__init__(wavelengths: list, exposure: int)</div>
<div class="line">        +gatherImages(output_dir: str, filename: str, calib_filepath: str, is_calib: bool)</div>
<div class="line">        +cleanup()</div>
<div class="line">    }</div>
<div class="line">    class PowerCalibrator{</div>
<div class="line">        //TODO: Not Implemented yet!</div>
<div class="line">        -calib</div>
<div class="line">        +calibrate_imagedata(wavelength_interval)</div>
<div class="line">    }</div>
<div class="line">    class ImageNormalizer {</div>
<div class="line">        -_calib: dict</div>
<div class="line"> </div>
<div class="line">        +__init__(calibration_file_path: str)</div>
<div class="line">        +normalize_image(wavelength: int, input_image: np.ndarray): np.ndarray</div>
<div class="line">    }</div>
<div class="line">    class ShowSpectra {</div>
<div class="line">        -root: tk.Tk</div>
<div class="line">        -x: int</div>
<div class="line">        -y: int</div>
<div class="line">        -filepath: str</div>
<div class="line">        -wavelength_min: int</div>
<div class="line">        -wavelength_max: int</div>
<div class="line">        -figure: plt.Figure</div>
<div class="line">        -ax: plt.Axes</div>
<div class="line">        -canvas: FigureCanvasTkAgg</div>
<div class="line"> </div>
<div class="line">        +__init__(root: tk.Tk, x: int, y: int, file_path: str, wavelength_min: int, wavelength_max: int)</div>
<div class="line">        +get_pixel_value(slide: int): int</div>
<div class="line">        +build_array_pixel(): np.ndarray</div>
<div class="line">        +show_image(): void</div>
<div class="line">    }</div>
<div class="line">        class ShowSpectra_Area {</div>
<div class="line">        -root: tk.Tk</div>
<div class="line">        -top_left: typing.Tuple</div>
<div class="line">        -bottom_right: typing.Tuple</div>
<div class="line">        -filepath: str</div>
<div class="line">        -wavelength_min: int</div>
<div class="line">        -wavelength_max: int</div>
<div class="line">        -figure: plt.Figure</div>
<div class="line">        -ax: plt.Axes</div>
<div class="line">        -canvas: FigureCanvasTkAgg</div>
<div class="line"> </div>
<div class="line">        +__init__(root: tk.Tk, topleft: typing.Tuple, bottomright: typing.Tuple, file_path: str, wavelength_min: int, wavelength_max: int)</div>
<div class="line">        +get_pixel_value(slide: int): int</div>
<div class="line">        +build_array_pixel(): np.ndarray</div>
<div class="line">        +show_image(): void</div>
<div class="line">        +crop_matrix_with_corners(matrix: np.ndarray): np.ndarray</div>
<div class="line">    }</div>
<div class="line">    class TifStackViewer_matplot {</div>
<div class="line">        -root: tk.Tk</div>
<div class="line">        -wavelength_intervall: list</div>
<div class="line">        -frame: tk.Frame</div>
<div class="line">        -current_index: int</div>
<div class="line">        -filepath: str</div>
<div class="line">        -load_button: tk.Button</div>
<div class="line">        -slider: tk.Scale</div>
<div class="line">        -fig: plt.Figure</div>
<div class="line">        -ax: plt.Axes</div>
<div class="line">        -canvas: FigureCanvasTkAgg</div>
<div class="line">        -toolbar: NavigationToolbar2Tk</div>
<div class="line">        -last_click_time: dt.datetime</div>
<div class="line">        -x1: int</div>
<div class="line">        -x2: int</div>
<div class="line">        -y1: int</div>
<div class="line">        -y2: int</div>
<div class="line">        -inner_plot: plt.Axes</div>
<div class="line"> </div>
<div class="line">        +__init__(root: tk.Tk)</div>
<div class="line">        +load_tif_stack(): void</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        +load_images_from_tif(file_path: str): list</div>
<div class="line">        +show_image(): void</div>
<div class="line">        +slider_control(value: float): void</div>
<div class="line"> </div>
<div class="line">        +on_canvas_click(event: Event): void</div>
<div class="line">        +on_canvas_release(event: Event): void</div>
<div class="line">    }</div>
</div><!-- fragment --><p> Note that the Power Calibrator is not implemented yet and would be necessary to establish a relation between the intensity captured by the camera and the total incident/reflected power distribution. </p>
<h1><a class="anchor" id="autotoc_md2"></a>
GUI Usage</h1>
<p>The main graphical user interface offers the initialization of a new measurement series using the Synchronizer and displaying existing data in a Viewer subroutine. The user flow is visualized in the following: </p><div class="fragment"><div class="line">flowchart TD</div>
<div class="line">    B[&quot;Main Window&lt;br&gt;- set Wavelength min and max&lt;br&gt;- set exposure time&lt;br&gt;- set filename&lt;br&gt;- select calibration file&quot;]</div>
<div class="line">    B --&gt;|collect image| C[&quot;Collects images for the set wavelengths in a tif file.&lt;br&gt;The values for the wavelength interval are stored in the filename.&quot;]</div>
<div class="line">    B --&gt;|Show images| D(&quot;Opens the window where the gathered images can be displayed&quot;)</div>
<div class="line">    D --&gt;|Load Tif| E(&quot;Opens the plot to show the image. The slider can be used to change the visible page of the tif file&quot;)</div>
<div class="line">    E --&gt;|one click| F(&quot;Shows the spectrum for the clicked location&quot;)</div>
<div class="line">    E --&gt;|drag mouse| G(&quot;Shows the mean spectrum for the highlighted area&quot;)</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md3"></a>
Image Processing</h1>
<p>The synchronizer useses reference intensity data to normalize the images, which was captured using a reference white scattering sample as the target. Thus the data is displayed in a relative scale to the corresponding incident flux density. After the normalization one could implement a power calibrator, which would put the captured intensity on the camera in relation to the total incident power. The flow can be visualized as following (Power calibrator not implemented!): </p><div class="fragment"><div class="line">flowchart LR</div>
<div class="line">    A[Raw Image]</div>
<div class="line">    A --&gt;|Normalize| B[Normalized Image]</div>
<div class="line">    B --&gt;|Get Power Values| C[Power Values]</div>
<div class="line">    style C stroke-dasharray: 5, 5</div>
<div class="line">    C --&gt;|Output| D[Output Image]</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
